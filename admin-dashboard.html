<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospital Management System</title>
    <link rel="stylesheet" href="styles11.css" />
  </head>
  <body>
    <!-- <section id="header">



      <a href="#"><img src="img/logo.avif" class="logo" alt="" /></a>

      <div>
        <ul id="navbar">
          <li><a href="index.html">Home</a></li>
          <li><a href="patient-login.html">Patient</a></li>
          <li><a href="doctor-login.html">Doctor</a></li>
          <li><a class="active" href="admin-login.html">Admin</a></li>
          <li>
            <a href="cart.html"><i class="far fa-shopping-bag"></i> </a>
          </li>
          <a href="#" id="close"><i class="far fa-times"></i></a>
        </ul>
      </div>
      <div id="mobile">
        <i id="bar" class="fas fa-outdent"></i>
      </div>
    </section> -->

    <section class="navbar2">
      <!-- <nav class="navbar2"> -->
      <ul class="navbar-nav">
        <li class="logo2">
          <a href="#" class="nav-link">
            <span class="link-text logo-text">SVR</span>
            <svg
              aria-hidden="true"
              focusable="false"
              data-prefix="fad"
              data-icon="angle-double-right"
              role="img"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"
              class="svg-inline--fa fa-angle-double-right fa-w-14 fa-5x"
            >
              <g class="fa-group">
                <path
                  fill="currentColor"
                  d="M224 273L88.37 409a23.78 23.78 0 0 1-33.8 0L32 386.36a23.94 23.94 0 0 1 0-33.89l96.13-96.37L32 159.73a23.94 23.94 0 0 1 0-33.89l22.44-22.79a23.78 23.78 0 0 1 33.8 0L223.88 239a23.94 23.94 0 0 1 .1 34z"
                  class="fa-secondary"
                ></path>
                <path
                  fill="currentColor"
                  d="M415.89 273L280.34 409a23.77 23.77 0 0 1-33.79 0L224 386.26a23.94 23.94 0 0 1 0-33.89L320.11 256l-96-96.47a23.94 23.94 0 0 1 0-33.89l22.52-22.59a23.77 23.77 0 0 1 33.79 0L416 239a24 24 0 0 1-.11 34z"
                  class="fa-primary"
                ></path>
              </g>
            </svg>
          </a>
        </li>

        <li class="nav-item" id="item1">
          <a
            href="admin-dashboard.html"
            data-page="dashboard"
            onclick="redirectTodashboard()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"
              />
            </svg>
            <span class="link-text">Dashboard</span>
          </a>
        </li>

        <li class="nav-item">
          <a
            href="admin-doctors.html"
            data-page="medical-records"
            onclick="redirecttomedhis()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-96 55.2C54 332.9 0 401.3 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7c0-81-54-149.4-128-171.1V362c27.6 7.1 48 32.2 48 62v40c0 8.8-7.2 16-16 16H336c-8.8 0-16-7.2-16-16s7.2-16 16-16V424c0-17.7-14.3-32-32-32s-32 14.3-32 32v24c8.8 0 16 7.2 16 16s-7.2 16-16 16H256c-8.8 0-16-7.2-16-16V424c0-29.8 20.4-54.9 48-62V304.9c-6-.6-12.1-.9-18.3-.9H178.3c-6.2 0-12.3 .3-18.3 .9v65.4c23.1 6.9 40 28.3 40 53.7c0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.4 16.9-46.8 40-53.7V311.2zM144 448a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"
              />
            </svg>
            <span class="link-text">Doctors</span>
          </a>
        </li>

        <li class="nav-item">
          <a
            href="admin-patients.html"
            data-page="prescription"
            onclick="redirectTopres()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M48 0C21.5 0 0 21.5 0 48V256H144c8.8 0 16 7.2 16 16s-7.2 16-16 16H0v64H144c8.8 0 16 7.2 16 16s-7.2 16-16 16H0v80c0 26.5 21.5 48 48 48H265.9c-6.3-10.2-9.9-22.2-9.9-35.1c0-46.9 25.8-87.8 64-109.2V271.8 48c0-26.5-21.5-48-48-48H48zM152 64h16c8.8 0 16 7.2 16 16v24h24c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H184v24c0 8.8-7.2 16-16 16H152c-8.8 0-16-7.2-16-16V152H112c-8.8 0-16-7.2-16-16V120c0-8.8 7.2-16 16-16h24V80c0-8.8 7.2-16 16-16zM512 272a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM288 477.1c0 19.3 15.6 34.9 34.9 34.9H541.1c19.3 0 34.9-15.6 34.9-34.9c0-51.4-41.7-93.1-93.1-93.1H381.1c-51.4 0-93.1 41.7-93.1 93.1z"
              />
            </svg>
            <span class="link-text">Patients</span>
          </a>
        </li>

        <li class="nav-item" id="themeButton">
          <a href="index.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
              />
            </svg>
            <span class="link-text">Logout</span>
          </a>
        </li>
      </ul>
    </section>

    <!-- <div class="main-content">
      <div class="appointment-list">
        <h2>Appointments</h2>
        <ul id="appointments-list" class="appointments-list beautiful-list">
        </ul>
      </div>
      <button id="open-appointment-dialog" class="appointment-button">
        Book Appointment
      </button>
    </div> -->

    <section class="dashboard page">
      <!-- Banner Section -->
      <div class="banner">
        <!-- First Box -->
        <div class="firstBox">
          <img
            class="img_admin"
            src="https://images.unsplash.com/photo-1542044896530-05d85be9b11a?q=80&w=3125&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="docImg"
          />
          <div class="content">
            <div>
              <h2>Hello, <strong>ADMIN</strong></h2>
            </div>
            <p>Welcome to the Admin Dashboard</p>
          </div>
        </div>
        <!-- Second Box -->
        <div class="secondBox">
          <h1>Total Pending Appointments</h1>
          <h1 id="totalAppointments">...</h1>
        </div>
        <!-- Third Box -->
        <div class="thirdBox">
          <h1>Registered Doctors</h1>
          <h1 id="registeredDoctors">...</h1>
        </div>
      </div>
      <!-- Appointments Table -->
      <div class="banner banner2">
        <h5>Appointments</h5>
        <table id="appointmentsTable">
          <thead>
            <tr>
              <th>Patient</th>
              <th>Date</th>
              <th>Doctor</th>
              <th>Department</th>
              <th>Status</th>
              <th>Appointment Id</th>
              <th>Reason</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="appointmentsBody">
            <!-- Appointments will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
      <!-- Appointment button -->
    </section>

    <div>
      <button id="open-appointment-dialog" class="appointment-button">
        Set Appointment
      </button>
    </div>

    <div id="appointment-dialog" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Set Appointment</h2>
        <form id="appointment-form">
          <div class="form-group">
            <label for="department">Appointment ID:</label>
            <textarea id="appid" name="department" required></textarea>
            <label for="department">Patient ID:</label>
            <textarea id="departmen1t" name="department" required></textarea>
            <!-- Add more options as needed -->
          </div>
          <div class="form-group">
            <label for="department">Department:(Optional)</label>
            <select id="department" name="department" required>
              <!-- Add more options as needed -->
            </select>
          </div>
          <div class="form-group">
            <label for="doctor">Doctor Name:(Optional)</label>
            <select id="doctor" name="doctor" required>
              <!-- Add more options as needed -->
            </select>
          </div>
          <div class="form-group">
            <label for="appointment-date">Date:</label>
            <input
              type="date"
              id="appointment-date"
              name="appointment-date"
              required
            />
          </div>
          <div class="form-group">
            <label for="concern">Time:</label>
            <input id="concern" name="concern" rows="4" required type="time" />
          </div>
          <div class="form-group">
            <label for="doctor">Status</label>
            <select id="status" name="doctor" required>
              <option value="Pending">Pending</option>
              <option value="rejected">Reject</option>
              <option value="Approved">Approve</option>
            </select>
          </div>
          <button type="submit">Submit</button>
        </form>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
      var modal = $("#appointment-dialog");
      var btn = $("#open-appointment-dialog");
      var closeSpan = $(".close");

      btn.click(function () {
        modal.show();
      });

      closeSpan.click(function () {
        modal.hide();
      });

      $(window).click(function (event) {
        if (event.target.id === "appointment-dialog") {
          modal.hide();
        }
      });
      document.addEventListener("DOMContentLoaded", async () => {

        $("#appid").focusout(async function (event){
          const response = await fetch("http://localhost:7878/appointmentextract", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              aid: document.getElementById("appid").value,
            }),
          });
          const data = await response.json();
          console.log(data);
          
          document.getElementById("department").value = data.name.dept_id;
          const response1 = await fetch(
              "http://localhost:7878/doctor_from_department",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  dept:data.name.dept_id,
                }),
              }
            );
            const data1 = await response1.json();
            console.log(data1.name);
            var doctorselect = document.getElementById("doctor");
            doctorselect.innerHTML = "";
            var option1 = document.createElement("option");
            option1.value = 0;
            option1.text = "Select Doctor";
            doctorselect.appendChild(option1);
            data1.name.forEach((element) => {
              var option = document.createElement("option");
              option.value = element.doctor_id;
              option.text = element.doctor_name;
              doctorselect.appendChild(option);
            });
          document.getElementById("doctor").value=data.name.doctor_id;
          document.getElementById("concern").value=data.name.reason;
          document.getElementById("appointment-date").value=data.name.adate;
          document.getElementById("departmen1t").value=data.name.patient_id;
        
        })

        $("#appointment-form").submit(async function (event) {
          event.preventDefault();
          var FormData = {
            did: document.getElementById("doctor").value,
            time: document.getElementById("concern").value,
            date: document.getElementById("appointment-date").value,
            status: document.getElementById("status").value,
            aid: document.getElementById("appid").value,
          };
          console.log(FormData);
          const response = await fetch(
            "http://localhost:7878/updateappointment",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(FormData),
            }
          );
          
          modal.hide();
        });

        const response = await fetch("http://localhost:7878/deptextract", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(),
        });
        const data = await response.json();

        var deptselect = document.getElementById("department");
        deptselect.innerHTML = "";
        var option1 = document.createElement("option");
        option1.value = 0;
        option1.text = "Select Department";
        deptselect.appendChild(option1);
        data.department.forEach((element) => {
          if (element.dept_id == 0) {
            // Remove the 'continue' statement
          } else {
            var option = document.createElement("option");
            option.value = element.dept_id;
            option.text = element.dept_name;
            deptselect.appendChild(option);
          }
        });
        document
          .getElementById("department")
          .addEventListener("change", async function () {
            const response = await fetch(
              "http://localhost:7878/doctor_from_department",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  dept: document.getElementById("department").value,
                }),
              }
            );
            const data = await response.json();
            console.log(data.name);
            var doctorselect = document.getElementById("doctor");
            doctorselect.innerHTML = "";
            var option1 = document.createElement("option");
            option1.value = 0;
            option1.text = "Select Doctor";
            doctorselect.appendChild(option1);
            data.name.forEach((element) => {
              var option = document.createElement("option");
              option.value = element.doctor_id;
              option.text = element.doctor_name;
              doctorselect.appendChild(option);
            });
          });

        // Fetch appointments and render table
        fetchAppointments();

        async function fetchAppointments() {
          try {
            const response = await fetch(
              "http://localhost:7878/allappointments",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(),
              }
            );

            const data = await response.json();
            console.log(data);

            // Update total appointments and registered doctors count
            document.getElementById("totalAppointments").textContent =
              data.totlapp.aids;
            document.getElementById("registeredDoctors").textContent =
              data.totld.dids;
            console.log("Hello" + data.appoinments);
            const tbody = document.getElementById("appointmentsBody");

            data.appoinments.forEach(function (appointment) {
              const row = tbody.insertRow();
              row.insertCell().textContent = appointment.patient_id;
              row.insertCell().textContent = appointment.appoint_date;
              row.insertCell().textContent = appointment.doctor_name;
              row.insertCell().textContent = appointment.dept_name;
              row.insertCell().textContent = appointment.status;
              row.insertCell().textContent = appointment.appointment_id;

              row.insertCell().textContent = appointment.reason;
              row.insertCell().textContent = appointment.appoint_time;
            });

            // Get reference to the appointments table body
            // Get a reference to the appointments table body
          } catch (error) {
            console.error("Error fetching appointments:", error);
          }
        }
      });
    </script>
  </body>
</html>
