<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospital Management System</title>
    <link rel="stylesheet" href="styles14.css" />
  </head>
  <body>
    <section class="navbar2">
      <!-- <nav class="navbar2"> -->
      <ul class="navbar-nav">
        <li class="logo2">
          <a href="#" class="nav-link">
            <span class="link-text logo-text">SVR</span>
            <svg
              aria-hidden="true"
              focusable="false"
              data-prefix="fad"
              data-icon="angle-double-right"
              role="img"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"
              class="svg-inline--fa fa-angle-double-right fa-w-14 fa-5x"
            >
              <g class="fa-group">
                <path
                  fill="currentColor"
                  d="M224 273L88.37 409a23.78 23.78 0 0 1-33.8 0L32 386.36a23.94 23.94 0 0 1 0-33.89l96.13-96.37L32 159.73a23.94 23.94 0 0 1 0-33.89l22.44-22.79a23.78 23.78 0 0 1 33.8 0L223.88 239a23.94 23.94 0 0 1 .1 34z"
                  class="fa-secondary"
                ></path>
                <path
                  fill="currentColor"
                  d="M415.89 273L280.34 409a23.77 23.77 0 0 1-33.79 0L224 386.26a23.94 23.94 0 0 1 0-33.89L320.11 256l-96-96.47a23.94 23.94 0 0 1 0-33.89l22.52-22.59a23.77 23.77 0 0 1 33.79 0L416 239a24 24 0 0 1-.11 34z"
                  class="fa-primary"
                ></path>
              </g>
            </svg>
          </a>
        </li>

        <li class="nav-item">
          <a
            href="admin-dashboard.html"
            data-page="dashboard"
            onclick="redirectTodashboard()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"
              />
            </svg>
            <span class="link-text">Dashboard</span>
          </a>
        </li>

        <li class="nav-item">
          <a
            href="admin-doctors.html"
            data-page="medical-records"
            onclick="redirecttomedhis()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-96 55.2C54 332.9 0 401.3 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7c0-81-54-149.4-128-171.1V362c27.6 7.1 48 32.2 48 62v40c0 8.8-7.2 16-16 16H336c-8.8 0-16-7.2-16-16s7.2-16 16-16V424c0-17.7-14.3-32-32-32s-32 14.3-32 32v24c8.8 0 16 7.2 16 16s-7.2 16-16 16H256c-8.8 0-16-7.2-16-16V424c0-29.8 20.4-54.9 48-62V304.9c-6-.6-12.1-.9-18.3-.9H178.3c-6.2 0-12.3 .3-18.3 .9v65.4c23.1 6.9 40 28.3 40 53.7c0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.4 16.9-46.8 40-53.7V311.2zM144 448a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"
              />
            </svg>
            <span class="link-text">Doctors</span>
          </a>
        </li>

        <li class="nav-item" id="item1">
          <a
            href="admin-patients.html"
            data-page="prescription"
            onclick="redirectTopres()"
            class="nav-link"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M48 0C21.5 0 0 21.5 0 48V256H144c8.8 0 16 7.2 16 16s-7.2 16-16 16H0v64H144c8.8 0 16 7.2 16 16s-7.2 16-16 16H0v80c0 26.5 21.5 48 48 48H265.9c-6.3-10.2-9.9-22.2-9.9-35.1c0-46.9 25.8-87.8 64-109.2V271.8 48c0-26.5-21.5-48-48-48H48zM152 64h16c8.8 0 16 7.2 16 16v24h24c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H184v24c0 8.8-7.2 16-16 16H152c-8.8 0-16-7.2-16-16V152H112c-8.8 0-16-7.2-16-16V120c0-8.8 7.2-16 16-16h24V80c0-8.8 7.2-16 16-16zM512 272a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM288 477.1c0 19.3 15.6 34.9 34.9 34.9H541.1c19.3 0 34.9-15.6 34.9-34.9c0-51.4-41.7-93.1-93.1-93.1H381.1c-51.4 0-93.1 41.7-93.1 93.1z"
              />
            </svg>
            <span class="link-text">Patients</span>
          </a>
        </li>

        <li class="nav-item" id="themeButton">
          <a href="index.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
              />
            </svg>
            <span class="link-text">Logout</span>
          </a>
        </li>
      </ul>
    </section>

    <div class="cont">
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="Search patients..."
          id="patientid"
        />
        <button class="search-button" id="psearch">Search</button>
      </div>
      <div>
        <button class="butt" id="open-appointment-dialog">Add Patient</button>
      </div>
    </div>

    <div class="card">
      <div class="banner banner2">
        <h3>Patients:</h3>
        <table id="appointmentsTable">
          <thead>
            <tr>
              <th>Id</th>
              <th>Name</th>
              <th>Phone</th>
              <th>Gender</th>
              <th>dob</th>
              <th>Height</th>
              <th>Weight</th>
              <th>Blood Group</th>
            </tr>
          </thead>
          <tbody id="appointmentsBody">
            <!-- Appointments will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
    </div>

    <div id="appointment-dialog" class="modal">
      <div class="container">
        <div class="patient-info-section">
          <span class="close">&times;</span>
          <h2 class="section-title">Add Patient Information</h2>
          <form action="#" class="patient-form" id="patientForm">
            <div class="form-group">
              <label for="first-name" class="form-label">First Name *</label>
              <input
                type="text"
                id="first-name"
                name="first-name"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label for="last-name" class="form-label">Last Name *</label>
              <input
                type="text"
                id="last-name"
                name="last-name"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label for="email" class="form-label">Email Id *</label>
              <input type="email" id="email" name="email" class="form-input" />
            </div>
            <div class="form-group">
              <label for="mobile-number" class="form-label"
                >Mobile Number *</label
              >
              <input
                type="text"
                id="mobile-number"
                name="mobile-number"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label for="gender" class="form-label">Gender *</label>
              <select id="gender" name="gender" class="form-select">
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="dob" class="form-label">Date of Birth *</label>
              <input type="date" id="dob" name="dob" class="form-input" />
            </div>
            <div class="form-group">
              <label for="height" class="form-label">Height (cm) *</label>
              <input type="text" id="height" name="height" class="form-input" />
            </div>
            <div class="form-group">
              <label for="weight" class="form-label">Weight (kg) *</label>
              <input type="text" id="weight" name="weight" class="form-input" />
            </div>
            <div class="form-group">
              <label for="blood-group" class="form-label">Blood Group *</label>
              <select id="blood-group" name="blood-group" class="form-select">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            <button id="newpa" type="submit" class="submit-btn">Submit</button>
          </form>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
      // script.js

      const phoneInput = document.getElementById("mobile-number");
      // Function to validate phone number
      function validatePhoneNumber() {
        const phoneNumber = phoneInput.value;
        const phoneNumberPattern = /^[0-9]{10}$/;
        if (!phoneNumberPattern.test(phoneNumber)) {
          alert("Enter a valid 10-digit number.");
          phoneInput.focus();
          return false;
        }
      }

      // Attach the validation function to the form’s submit event
      const form = document.getElementById("patientForm");
      form.addEventListener("submit", async function (event) {
        if (validatePhoneNumber()) {
          formData = {
            firstName: document.getElementById("first-name").value,
            lastName: document.getElementById("last-name").value,
            email: document.getElementById("email").value,
            mobileNumber: document.getElementById("mobile-number").value,
            gender: document.getElementById("gender").value,
            dob: document.getElementById("dob").value,
            bloodGroup: document.getElementById("blood-group").value,
            height: document.getElementById("height").value,
            weight: document.getElementById("weight").value,
          };
          console.log(formData);
          const response = await fetch("http://localhost:7878/newpatient", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ formData, randd: 0 }),
          });
          document.getElementById("first-name").value = null;
          document.getElementById("last-name").value = null;
          document.getElementById("email").value = null;
          document.getElementById("mobile-number").value = null;
          document.getElementById("gender").value = null;
          document.getElementById("dob").value = null;
          document.getElementById("blood-group").value = null;
          modal.hide();
          alert("Patient Added Successfully"); // Prevent form submission if validation fails
        }
      });

      var modal = $("#appointment-dialog");
      var btn = $("#open-appointment-dialog");
      var closeSpan = $(".close");

      btn.click(function () {
        modal.show();
      });

      closeSpan.click(function () {
        modal.hide();
      });

      $(window).click(function (event) {
        if (event.target.id === "appointment-dialog") {
          modal.hide();
        }
      });

      document.addEventListener("DOMContentLoaded", async () => {
        const response = await fetch("http://localhost:7878/allpatients", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ pid: -1 }),
        });
        const data = await response.json();
        const tbody = document.getElementById("appointmentsBody");
        data.patient.forEach((element) => {
          console.log(element);
          const row = tbody.insertRow();
          row.insertCell().textContent = element.patient_id;
          row.insertCell().textContent = element.patient_name;
          row.insertCell().textContent = element.phone;
          row.insertCell().textContent = element.gender;
          row.insertCell().textContent = element.dob;
          row.insertCell().textContent = element.height;

          row.insertCell().textContent = element.weight;
          row.insertCell().textContent = element.blood;
        });
      });

      but = document.getElementById("patientid");
      but.addEventListener("input", async () => {
        pid = document.getElementById("patientid").value;
        if (pid == "") {
          pid = -1;
        }
        pid = parseInt(pid);
        const response = await fetch("http://localhost:7878/allpatients", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ pid: pid }),
        });
        const data = await response.json();
        const tbody = document.getElementById("appointmentsBody");
        tbody.innerHTML = "";
        if (data.patient.length == 0) {
          alert("No such patient found");
        } else {
          data.patient.forEach((element) => {
            console.log(element);
            const row = tbody.insertRow();
            row.insertCell().textContent = element.patient_id;
            row.insertCell().textContent = element.patient_name;
            row.insertCell().textContent = element.phone;
            row.insertCell().textContent = element.gender;
            row.insertCell().textContent = element.dob;
            row.insertCell().textContent = element.height;
            row.insertCell().textContent = element.weight;
            row.insertCell().textContent = element.blood;
          });
        }
      });
    </script>
  </body>
</html>
